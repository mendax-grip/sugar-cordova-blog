<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<title>Sugar Web-Architecture | Sugar-Cordova</title>
	<meta name="description" content="" />
	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" href="/sugar-cordova-blog/css/component.css" />
	<link rel="stylesheet" type="text/css" href="/sugar-cordova-blog/css/screen.css" />
	<link rel="stylesheet" type="text/css" href="/sugar-cordova-blog/css/inlineDisqussions.css" />
	<meta name="generator" content="Sugar-Cordova">
	
	
	

	

</head>
<body>
	<div class="container">
		<div class="mp-pusher" id="mp-pusher">
			<i id="scroll-up" class="fa fa-angle-up"></i>
			<nav id="mp-menu" class="mp-menu">
				<div class="mp-level">
					<a data-pjax class="back-home" style="font-size: 20px" href="/sugar-cordova-blog/"><h2 ><i class="fa fa-home"></i>
						Home</h2></a>
						<ul class="first-level">
							<li>
								<a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
								</i>&nbsp;&nbsp;Archive</a>
								<div class="mp-level page-list">
									<h2 ><i class="fa fa-archive"></i>
										Archive</h2>
										<a class="mp-back" href="#">back</a>
										<form id="search-form" action="">
											<input type="text" class="search search-archive" placeholder="Search.."/>
										</form>
										<ul>
											<div class="mp-scroll">
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/plugin-development-guide/">Plugin Development Guide for Cordova</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/Plugin/">Accelerator Plugin</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/Activity/">Markdown Editor Activity</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/Architecture/">Sugar Web-Architecture</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/23/Checklist/">Checklist</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/23/hello-world/">Hello World</a>
												</li>
												
											</div>
										</ul>
									</div>
								</li>
								<li>
									<a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
									</i>&nbsp;&nbsp;Categories</a>

									<div class="mp-level page-list">
										<h2 ><i class="fa fa-copy"></i>
											Categories</h2>
											<a class="mp-back" href="#">back</a>
											<form id="search-form" action="">
												<input type="text" class="search search-category" placeholder="Search.."/>
											</form>
											<ul>
												<div class="mp-scroll">
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/Guide/">&nbsp;&nbsp;&nbsp;Guide</a>
														<small>1</small>
													</li>
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/Introduction/">&nbsp;&nbsp;&nbsp;Introduction</a>
														<small>1</small>
													</li>
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/Tutorial/">&nbsp;&nbsp;&nbsp;Tutorial</a>
														<small>2</small>
													</li>
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/checklist/">&nbsp;&nbsp;&nbsp;checklist</a>
														<small>1</small>
													</li>
													
												</div>
											</ul>
										</div>
									</li>
									<li>
										<a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
										</i>&nbsp;&nbsp;Tags</a>
										<div class="mp-level page-list">
											<h2 ><i class="fa fa-tags"></i>
												Tags</h2>
												<a class="mp-back" href="#">back</a>
												<form id="search-form" action="">
													<input type="text" class="search search-tag" placeholder="Search.."/>
												</form>
												<ul>
													<div class="mp-scroll">
														
													</div>
												</ul>
											</div>
										</li>
										
											<li class="mp-pjax"><a class="fa fa-user" href="/sugar-cordova-blog/about">&nbsp;&nbsp;&nbsp;About me</a></li>
											<li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li>

										</ul>

									</div>
								</nav>
								<div id="pjax">
									<div class="pjax-hidden" style="display: none">
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/plugin-development-guide/">Plugin Development Guide for Cordova</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/Plugin/">Accelerator Plugin</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/Activity/">Markdown Editor Activity</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/Architecture/">Sugar Web-Architecture</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/23/Checklist/">Checklist</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/23/hello-world/">Hello World</a>
										
										
										<a data-pjax href="/sugar-cordova-blog/categories/Guide/">&nbsp;&nbsp;Guide</a>
										
										<a data-pjax href="/sugar-cordova-blog/categories/Introduction/">&nbsp;&nbsp;Introduction</a>
										
										<a data-pjax href="/sugar-cordova-blog/categories/Tutorial/">&nbsp;&nbsp;Tutorial</a>
										
										<a data-pjax href="/sugar-cordova-blog/categories/checklist/">&nbsp;&nbsp;checklist</a>
										
										
										<a data-pjax class="fa fa-user" href="/sugar-cordova-blog/about">&nbsp;&nbsp;&nbsp;About me</a>
									</div>
									<nav class="nexus">
										<li  style="border-left: 1px solid #c6d0da;">
											<a id="trigger" href="#"><i class="fa fa-bars"></i></a>
										</li>
										<li ><a id="nexus-back" data-pjax href="/sugar-cordova-blog/">Sugar-Cordova</a></li>
										
										<div id="nav-container">
											<div class="post-navbar" style="line-height: 63px;display:none">
												<li id="navbar-title"><a href="#">Sugar Web-Architecture</a></li>
												<li id="navbar-toc" style="border-left: none">
													<a style="padding-right: 15px">
														<span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
													</a>
													<div class="hidden-box">
														<ul id="toc"></ul>
													</div>
												</li>
											</div>
										</div>
										
									</nav>

									<div class="scroller">
										<div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->


<main class="content" role="main">
	<article class="post" >
		<span class="post-meta">
			<div class="tag-tile">
				
			</div>
			<h1 class="post-title" style="margin: 14px 0;color:#50585D">Sugar Web-Architecture</h1>

			<div class="post-meta">
				Post on<span class="fa fa-clock-o"></span>
				<time datetime="2015-03-25T04:33:50.000Z"
					itemprop="datePublished">2015-03-25</time>
				</div>
			</span>

			<section class="post-content">
				<h2 id="Sugar_Web_Architecture">Sugar Web Architecture</h2><p>It was build to enable web developers develop activities for Sugar-Labs without learning to build in python which SugarLabs is orginally made up of. It has been developed keeping in mind, that there should be no difference in the activity designed by python or through HTML5.</p>
<p>The activities developed by HTML5 run via a Webkit instance. The javascript framework underlying the web-architecture provides support to create HTML control matching Sugar widgets and give access to API for Telepathy and Datastore which are the neighbourhood communication and Journal R/W of SugarLabs respectively.</p>
<h2 id="Creating_a_Web_Activity">Creating a Web Activity</h2><p>In order start creating an activity for Sugar using Sugar-web, this particular <a href="http://developer.sugarlabs.org/activity.md.html" target="_blank" rel="external">post</a> will meet all your developing needs.</p>
<p>Note: By using default template sugar-web-template, the job of creating activity becomes a lot easier. This post assumes that you do the same.</p>
<h2 id="Working_of_Activiy">Working of Activiy</h2><p>An activity explicitly uses async feature javascript. When using sugar-web-template, this provided by <a href="http://requirejs.org/." target="_blank" rel="external"><strong>requirejs</strong></a> which holds together all the dependecies together. In order to mimic the DOMContentLoaded event in browsers, the requireJS has a similar DOM ready feature.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([‘domReady!’], <span class="function"><span class="keyword">function</span> <span class="params">(doc)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//code</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This ensures that the various elements of DOM are ready before we use them.</p>
<h2 id="Sugar_UI_Replication">Sugar UI Replication</h2><p>CSS and JS are responsible for Sugar UI replication particulary <em>sugar-web/graphics/</em> . It uses LESS framework to compile the CSS.</p>
<h2 id="Communication_between_Sugar_and_Javascript_Framework">Communication between Sugar and Javascript Framework</h2><p>To use Sugar API from Javascript, a call needs to made to the underlying python code. The javascript can make a call while encoding in JSON/binary format through websockets. The corresponding call from framework is retrieved in API Sockets program ( /sugar/src/jarabe/apisocket.py ). So for each corresponding call we have to code in the <strong>apisocket.py</strong> file.</p>
<p>For example the format of making a call from say, datastore which has the following methods we can call for.</p>
<p>Lets see how the datastore in javascript calls of save to Sugar.</p>
<p><strong>file - datastore.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">datastore.save = <span class="function"><span class="keyword">function</span> <span class="params">(objectId, metadata, callback)</span> </span>&#123;  <span class="comment">// Using objectID, metadata and Callback</span></span><br><span class="line">    <span class="keyword">var</span> outputStream = bus.createOutputStream();            <span class="comment">// Creating output stream</span></span><br><span class="line"></span><br><span class="line">    outputStream.open(<span class="function"><span class="keyword">function</span> <span class="params">(error)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">onResponseReceived</span><span class="params">(responseError, result)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (responseError === <span class="literal">null</span>) &#123;</span><br><span class="line">                callback(<span class="literal">null</span>, outputStream);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                callback(responseError, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> params = [objectId, metadata, outputStream.streamId];   <span class="comment">// Defining parameters</span></span><br><span class="line">        bus.sendMessage(<span class="string">"datastore.save"</span>, params, onResponseReceived);  <span class="comment">// This is the template for making calls to the API  </span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>So, how does the bus uses its arguements. Lets have a look.<br><strong>file - bus.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">bus.sendMessage = <span class="function"><span class="keyword">function</span> <span class="params">(method, params, callback)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> message = &#123;</span><br><span class="line">          <span class="string">"method"</span>: method,</span><br><span class="line">          <span class="string">"id"</span>: lastId,</span><br><span class="line">          <span class="string">"params"</span>: params,</span><br><span class="line">          <span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">          callbacks[lastId] = callback;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      client.send(<span class="built_in">JSON</span>.stringify(message));     <span class="comment">//The message is encoded in JSON format</span></span><br><span class="line"></span><br><span class="line">      lastId++;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>We can see the main work of making a call to API is done in the bus.js.</p>
<p><strong>file- apisocket.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatastoreAPI</span><span class="params">(API)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, request)</span>:</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">reply_handler</span><span class="params">()</span>:</span></span><br><span class="line">          self._client.send_result(info[<span class="string">"close_request"</span>], [])</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">error_handler</span><span class="params">(error)</span>:</span></span><br><span class="line">          self._client.send_error(info[<span class="string">"close_request"</span>], error)</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">on_data</span><span class="params">(data)</span>:</span></span><br><span class="line">          file_object.write(data[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">on_close</span><span class="params">(close_request)</span>:</span></span><br><span class="line">          file_object.close()</span><br><span class="line"></span><br><span class="line">          info[<span class="string">"close_request"</span>] = close_request</span><br><span class="line">          self._data_store.update(uid, metadata, file_path, <span class="keyword">True</span>,</span><br><span class="line">                                  reply_handler=reply_handler,</span><br><span class="line">                                  error_handler=error_handler)</span><br><span class="line"></span><br><span class="line">      info = &#123;&#125;</span><br><span class="line"></span><br><span class="line">      uid, metadata, stream_id = request[<span class="string">"params"</span>]</span><br><span class="line"></span><br><span class="line">      file_path, file_object = self._create_file()</span><br><span class="line"></span><br><span class="line">      stream_monitor = self._client.stream_monitors[stream_id]</span><br><span class="line">      stream_monitor.on_data = on_data</span><br><span class="line">      stream_monitor.on_close = on_close</span><br><span class="line"></span><br><span class="line">      self._client.send_result(request, [])   //Returns a stream qith result attached</span><br></pre></td></tr></table></figure>
<p>Here is the corresponding request handling in the apisocket. Obviously, these are different for different request.</p>
<h2 id="Testing">Testing</h2><p>The Sugar used to use Jasmine for testing but right now, it is using Karma for unit and functional testing. The sugar-web/test folder holds all the unit and functional tests written.</p>

			</section>
			<hr/>
			<nav class="pagination" style="width:auto" role="pagination">
				
				<a data-pjax class="newer-posts" href="/sugar-cordova-blog/2015/03/25/Activity/">← Prev Post</a>
				
				<a class="share-button" data-original-title title>Share this Post</a>
				
				<a data-pjax class="older-posts" href="/sugar-cordova-blog/2015/03/23/Checklist/">Next Post →</a>
				
			</nav>
			<br/>
			<br/>
			<section id="comment">
				<div id="comment-box"></div>
				

			</section>


		</article>
	</main>



<footer class="site-footer">
	
	<div class="inner">
		<section class="copyright"><a href="/sugar-cordova-blog/"></a> &copy; Sugar-Cordova 2014</section>
		<section class="poweredby">Powered by <a target="_blank" href="http://hexo.io/">Hexo   </a> and Themed by <a target="_blank" href="https://github.com/codepreneur/hexo-theme-kael">codepreneur</a></section>
	</div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
	<a id="close-button" href="#">X</a>
	<div class="block">
		<div class="loading">
			<span class="ball1"></span>
			<span class="ball2"></span>
		</div>
	</div>
</div>

<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
	if (!window.jQuery) {
		var script = document.createElement('script');
		script.src = "/sugar-cordova-blog/js/jquery.min.js";
		document.body.appendChild(script);
	}
</script>
<script type="text/javascript" src="/sugar-cordova-blog/js/inlineDisqussions.js"></script>
<script type="text/javascript" src="/sugar-cordova-blog/js/lib.js"></script>
<script type="text/javascript" src="/sugar-cordova-blog/js/main.js"></script>







</body>
</html>
