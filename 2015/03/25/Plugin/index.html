<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<title>Accelerator Plugin | Sugar-Cordova</title>
	<meta name="description" content="" />
	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" href="/sugar-cordova-blog/css/component.css" />
	<link rel="stylesheet" type="text/css" href="/sugar-cordova-blog/css/screen.css" />
	<link rel="stylesheet" type="text/css" href="/sugar-cordova-blog/css/inlineDisqussions.css" />
	<meta name="generator" content="Sugar-Cordova">
	
	
	

	

</head>
<body>
	<div class="container">
		<div class="mp-pusher" id="mp-pusher">
			<i id="scroll-up" class="fa fa-angle-up"></i>
			<nav id="mp-menu" class="mp-menu">
				<div class="mp-level">
					<a data-pjax class="back-home" style="font-size: 20px" href="/sugar-cordova-blog/"><h2 ><i class="fa fa-home"></i>
						Home</h2></a>
						<ul class="first-level">
							<li>
								<a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
								</i>&nbsp;&nbsp;Archive</a>
								<div class="mp-level page-list">
									<h2 ><i class="fa fa-archive"></i>
										Archive</h2>
										<a class="mp-back" href="#">back</a>
										<form id="search-form" action="">
											<input type="text" class="search search-archive" placeholder="Search.."/>
										</form>
										<ul>
											<div class="mp-scroll">
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/plugin-development-guide/">Plugin Development Guide for Cordova</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/Plugin/">Accelerator Plugin</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/Activity/">Markdown Editor Activity</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/25/Architecture/">Sugar Web-Architecture</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/23/Checklist/">Checklist</a>
												</li>
												
												<li class="search-archive-li mp-pjax">
													<a href="/sugar-cordova-blog/2015/03/23/hello-world/">Hello World</a>
												</li>
												
											</div>
										</ul>
									</div>
								</li>
								<li>
									<a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
									</i>&nbsp;&nbsp;Categories</a>

									<div class="mp-level page-list">
										<h2 ><i class="fa fa-copy"></i>
											Categories</h2>
											<a class="mp-back" href="#">back</a>
											<form id="search-form" action="">
												<input type="text" class="search search-category" placeholder="Search.."/>
											</form>
											<ul>
												<div class="mp-scroll">
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/Guide/">&nbsp;&nbsp;&nbsp;Guide</a>
														<small>1</small>
													</li>
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/Introduction/">&nbsp;&nbsp;&nbsp;Introduction</a>
														<small>1</small>
													</li>
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/Tutorial/">&nbsp;&nbsp;&nbsp;Tutorial</a>
														<small>2</small>
													</li>
													
													<li class="search-category-li mp-pjax">
														<a href="/sugar-cordova-blog/categories/checklist/">&nbsp;&nbsp;&nbsp;checklist</a>
														<small>1</small>
													</li>
													
												</div>
											</ul>
										</div>
									</li>
									<li>
										<a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
										</i>&nbsp;&nbsp;Tags</a>
										<div class="mp-level page-list">
											<h2 ><i class="fa fa-tags"></i>
												Tags</h2>
												<a class="mp-back" href="#">back</a>
												<form id="search-form" action="">
													<input type="text" class="search search-tag" placeholder="Search.."/>
												</form>
												<ul>
													<div class="mp-scroll">
														
													</div>
												</ul>
											</div>
										</li>
										
											<li class="mp-pjax"><a class="fa fa-user" href="/sugar-cordova-blog/about">&nbsp;&nbsp;&nbsp;About me</a></li>
											<li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li>

										</ul>

									</div>
								</nav>
								<div id="pjax">
									<div class="pjax-hidden" style="display: none">
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/plugin-development-guide/">Plugin Development Guide for Cordova</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/Plugin/">Accelerator Plugin</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/Activity/">Markdown Editor Activity</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/25/Architecture/">Sugar Web-Architecture</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/23/Checklist/">Checklist</a>
										
										<a  data-pjax href="/sugar-cordova-blog/2015/03/23/hello-world/">Hello World</a>
										
										
										<a data-pjax href="/sugar-cordova-blog/categories/Guide/">&nbsp;&nbsp;Guide</a>
										
										<a data-pjax href="/sugar-cordova-blog/categories/Introduction/">&nbsp;&nbsp;Introduction</a>
										
										<a data-pjax href="/sugar-cordova-blog/categories/Tutorial/">&nbsp;&nbsp;Tutorial</a>
										
										<a data-pjax href="/sugar-cordova-blog/categories/checklist/">&nbsp;&nbsp;checklist</a>
										
										
										<a data-pjax class="fa fa-user" href="/sugar-cordova-blog/about">&nbsp;&nbsp;&nbsp;About me</a>
									</div>
									<nav class="nexus">
										<li  style="border-left: 1px solid #c6d0da;">
											<a id="trigger" href="#"><i class="fa fa-bars"></i></a>
										</li>
										<li ><a id="nexus-back" data-pjax href="/sugar-cordova-blog/">Sugar-Cordova</a></li>
										
										<div id="nav-container">
											<div class="post-navbar" style="line-height: 63px;display:none">
												<li id="navbar-title"><a href="#">Accelerator Plugin</a></li>
												<li id="navbar-toc" style="border-left: none">
													<a style="padding-right: 15px">
														<span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
													</a>
													<div class="hidden-box">
														<ul id="toc"></ul>
													</div>
												</li>
											</div>
										</div>
										
									</nav>

									<div class="scroller">
										<div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->


<main class="content" role="main">
	<article class="post" >
		<span class="post-meta">
			<div class="tag-tile">
				
			</div>
			<h1 class="post-title" style="margin: 14px 0;color:#50585D">Accelerator Plugin</h1>

			<div class="post-meta">
				Post on<span class="fa fa-clock-o"></span>
				<time datetime="2015-03-25T11:26:49.000Z"
					itemprop="datePublished">2015-03-25</time>
				</div>
			</span>

			<section class="post-content">
				<h2 id="The_Accelerator_Plugin">The Accelerator Plugin</h2><p>While trying to understand how the plugins work, let’s decode the implementation of Accelerator Plugin during last years GSoC by <a href="https://github.com/puneetgkaur" target="_blank" rel="external">Puneet Kaur</a>.</p>
<h2 id="Javascript_Side_-_Accelerometer-js">Javascript Side - Accelerometer.js</h2><p>The following script is of accelerometer plugin</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bus = <span class="built_in">require</span>(<span class="string">'cordova/sugar/bus'</span>);  <span class="comment">// Import Bus</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bus.listen();         <span class="comment">// EventListening Start</span></span><br><span class="line"></span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onResponseReceived</span><span class="params">(err, result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!err) &#123;             <span class="comment">// Error handling</span></span><br><span class="line">      <span class="comment">// console.log("result : "+JSON.stringify(result));</span></span><br><span class="line">      <span class="comment">// console.log("result : "+result);</span></span><br><span class="line">      <span class="comment">// console.log("Its success");</span></span><br><span class="line">            result.timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">            cordova.fireWindowEvent(<span class="string">'devicemotion'</span>,result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// console.log("error:"+JSON.stringify(err));</span></span><br><span class="line">      <span class="comment">// console.log("Its error");</span></span><br><span class="line">      <span class="comment">// cordova.callbackError(callbackId,error);</span></span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     bus.sendMessage(<span class="string">'activity.cordova'</span>,[<span class="string">'Accelerometer'</span>,<span class="string">'getCurrentAcceleration'</span>,[]],onResponseReceived);</span><br><span class="line">           &#125;,<span class="number">1000</span>);         <span class="comment">//  bus.sendMessage(plugin, params, onResponseReceived) Communication to native side occurs through this function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> accelerometer_running=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listener</span><span class="params">(success, ev)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// console.log("ev:"+JSON.stringify(ev));</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// acc.timestamp = new Date().getTime();</span></span><br><span class="line">    success(ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Accelerometer = &#123;           <span class="comment">// Creation of Accelerometer Object</span></span><br><span class="line">    start: <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">(success, error)</span> </span>&#123;       <span class="comment">// Function Start is defined</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"In start acceleration"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"accelerometer_running = "</span>+accelerometer_running);</span><br><span class="line"></span><br><span class="line">        accelerometer_running = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"accelerometer_running = "</span>+accelerometer_running);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.addEventListener(<span class="string">'devicemotion'</span>, <span class="function"><span class="keyword">function</span><span class="params">(ev)</span> </span>&#123;</span><br><span class="line">            listener(success, ev);</span><br><span class="line">        &#125;, <span class="literal">false</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    stop: <span class="function"><span class="keyword">function</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;             <span class="comment">// Function Stop is defined</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"In stop acceleration"</span>);</span><br><span class="line"></span><br><span class="line">        accelerometer_running=<span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"accelerometer_running = "</span>+accelerometer_running);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">window</span>.removeEventListener(<span class="string">'devicemotion'</span>, listener, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Accelerometer;         <span class="comment">// Export the accelerometer plugin</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'cordova/sugar/commandProxy'</span>).add(<span class="string">'Accelerometer'</span>, Accelerometer);</span><br></pre></td></tr></table></figure>
<h2 id="API_Socket-py_-_Native_Side">API Socket.py - Native Side</h2><p>The encoded JSON message is received at apisocket.py.<br>The following part of apisocket.py is important for us to analyse.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActivityAPI</span><span class="params">(API)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cordova</span><span class="params">(self, request)</span>:</span></span><br><span class="line">      plugin_name, service_name, args = request[<span class="string">'params'</span>]</span><br><span class="line">      call_cordova(plugin_name, service_name, args, self, request)</span><br></pre></td></tr></table></figure>
<h2 id="Cordova_Socket">Cordova Socket</h2><p>Cordova socket identifies the required plugin or gives error when the requested plugin in unavailable.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_cordova</span><span class="params">(plugin_name, function_name, args, parent,</span><br><span class="line">                        request)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plugin_filecode = getattr(sys.modules[__name__],</span><br><span class="line">                                  <span class="string">"cordova_"</span> + plugin_name)</span><br><span class="line">        <span class="comment"># the class name for the plugin must be same as the plugin name</span></span><br><span class="line">        plugin_class = getattr(plugin_filecode, plugin_name)()</span><br><span class="line">        <span class="comment"># The service method same as that described for the given class</span></span><br><span class="line">        service_method = getattr(plugin_class, function_name)</span><br><span class="line">        <span class="comment"># give the parameters in args</span></span><br><span class="line">        result = service_method(args, parent, request)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        parent._client.send_error(request, <span class="string">"The native func doesn't exist"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Accelerator_Plugin">Accelerator Plugin</h2><p>This is the main program which returns response for proper requests.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Accelerometer</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentAcceleration</span><span class="params">(self, args, parent, request)</span>:</span></span><br><span class="line">        timestamp = time.time()</span><br><span class="line">        ACCELEROMETER_DEVICE = <span class="string">'/sys/devices/platform/lis3lv02d/position'</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            fh = open(ACCELEROMETER_DEVICE,<span class="string">"r"</span>)</span><br><span class="line">            string = fh.read()</span><br><span class="line">            xyz = string[<span class="number">1</span>:-<span class="number">2</span>].split(<span class="string">','</span>)</span><br><span class="line">            fh.close()</span><br><span class="line">            accelerometer_obj = &#123;<span class="string">'x'</span>: int(xyz[<span class="number">0</span>]), <span class="string">'y'</span>: int(xyz[<span class="number">1</span>]),</span><br><span class="line">                                 <span class="string">'z'</span>: int(xyz[<span class="number">2</span>]), <span class="string">'timestamp'</span>: timestamp,</span><br><span class="line">                                 <span class="string">'keepCallback'</span>: <span class="keyword">True</span>&#125;</span><br><span class="line">            parent._client.send_result(request, accelerometer_obj)</span><br><span class="line">        <span class="keyword">except</span> IOError:</span><br><span class="line">            accelerometer_obj = &#123;<span class="string">'x'</span>: <span class="number">0</span>, <span class="string">'y'</span>: <span class="number">0</span>, <span class="string">'z'</span>: <span class="number">0</span>,</span><br><span class="line">                                 <span class="string">'timestamp'</span>: timestamp,</span><br><span class="line">                                 <span class="string">'keepCallback'</span>: <span class="keyword">True</span>&#125;</span><br><span class="line">            parent._client.send_error(request, <span class="string">"Error accessing the Accelerometer File"</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            parent._client.send_error(request, <span class="string">"Error accessing the Accelerometer File"</span>)</span><br></pre></td></tr></table></figure>

			</section>
			<hr/>
			<nav class="pagination" style="width:auto" role="pagination">
				
				<a data-pjax class="newer-posts" href="/sugar-cordova-blog/2015/03/25/plugin-development-guide/">← Prev Post</a>
				
				<a class="share-button" data-original-title title>Share this Post</a>
				
				<a data-pjax class="older-posts" href="/sugar-cordova-blog/2015/03/25/Activity/">Next Post →</a>
				
			</nav>
			<br/>
			<br/>
			<section id="comment">
				<div id="comment-box"></div>
				

			</section>


		</article>
	</main>



<footer class="site-footer">
	
	<div class="inner">
		<section class="copyright"><a href="/sugar-cordova-blog/"></a> &copy; Sugar-Cordova 2014</section>
		<section class="poweredby">Powered by <a target="_blank" href="http://hexo.io/">Hexo   </a> and Themed by <a target="_blank" href="https://github.com/codepreneur/hexo-theme-kael">codepreneur</a></section>
	</div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
	<a id="close-button" href="#">X</a>
	<div class="block">
		<div class="loading">
			<span class="ball1"></span>
			<span class="ball2"></span>
		</div>
	</div>
</div>

<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
	if (!window.jQuery) {
		var script = document.createElement('script');
		script.src = "/sugar-cordova-blog/js/jquery.min.js";
		document.body.appendChild(script);
	}
</script>
<script type="text/javascript" src="/sugar-cordova-blog/js/inlineDisqussions.js"></script>
<script type="text/javascript" src="/sugar-cordova-blog/js/lib.js"></script>
<script type="text/javascript" src="/sugar-cordova-blog/js/main.js"></script>







</body>
</html>
